<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core" template="index.xhtml">

	<ui:define name="centro">

		<style>
.textArea {
	resize: none;
	width: 500px;
	height: 300px;
	overflow-y: auto;
	margin-left: 400px;
	margin-top: 10px;
}

.old {
	background-color: #CCCCDD;
	color: red;
}

.companyHeaderGrid tr, .companyHeaderGrid td {
	border: none !important;
}

.centralizado tr, .centralizado td {
	text-align: center;
}
</style>

		<style>
.semBorda tr, .semBorda td {
	border: none !important;
}
</style>

		<p:messages id="growl" showDetail="false" closable="true" />
		
		<h:form id="formPesquisar">
			<p:fieldset legend="Pesquisar listas" toggleable="true"
				toggleSpeed="500" id="fieldsetPesquisa">
				<p:panelGrid columns="2" styleClass="semBorda" id="panelFiltros">
					<p:outputLabel value="Pesquisar aluno pelo nome: "
						for="autoCompleteAluno" style="font-size:14px; font-weight:bold"></p:outputLabel>
					<p:autoComplete id="autoCompleteAluno"
						value="#{relatorioListasPorAluno.estudante}"
						completeMethod="#{relatorioListasPorAluno.buscarEstudante}"
						converter="estudanteConverter" var="estudante" event="itemselect"
						itemLabel="#{estudante.nome}" itemValue="#{estudante}"
						minQueryLength="1" forceSelection="true" size="50"
						style="font-size:14px">
						<p:ajax listener="#{relatorioListasPorAluno.doNothing()}" event="itemSelect" update="fieldsetPesquisa :formTabelaListas:fieldsetTabelaListas"/>
					</p:autoComplete>
					<p:outputLabel id="labelSituacao" for="comboSituacao" value="Selecione a situação: " rendered="#{not empty relatorioListasPorAluno.estudante}"/>
					<p:selectOneMenu id="comboSituacao" rendered="#{not empty relatorioListasPorAluno.estudante}"
						value="#{relatorioListasPorAluno.situacaoSelecionada}" required="false">
						<f:selectItem itemLabel="todas" itemValue="" />
						<f:selectItems value="#{relatorioListasPorAluno.situacoes}" />
					</p:selectOneMenu>
				</p:panelGrid>
				<p:panelGrid columns="3" cellpadding="10" id="botoes" rendered="#{not empty relatorioListasPorAluno.estudante}">
					<p:commandButton value="Pesquisar " id="ajax" update="@form"
						actionListener="#{relatorioListasPorAluno.pesquisar}"
						styleClass="ui-priority-primary" ajax="false" rendered="#{not empty relatorioListasPorAluno.estudante}"/>

					<p:commandButton value="Limpar " id="ajax2" update="@form"
						actionListener="#{relatorioListasPorAluno.limpar}"
						styleClass="ui-priority-primary" ajax="false" rendered="#{not empty relatorioListasPorAluno.estudante}"/>

				</p:panelGrid>
			</p:fieldset>

		</h:form>

		<p></p>
		<h:form id="formTabelaListas" enctype="multipart/form-data">
			<p:fieldset id="fieldsetTabelaListas" legend="Listas" toggleable="true" toggleSpeed="500" rendered="#{not empty relatorioListasPorAluno.estudante}">

				<p:dataTable var="item" paginator="true" rows="5" emptyMessage="Nenhuma lista encontrada"
					style="text-align: center" paginatorPosition="bottom" lazy="true"
					id="tabelaListas" widgetVar="tabelaListas" value="#{relatorioListasPorAluno.listas}"
					rowKey="item" sortMode="multiple" rendered="#{not empty relatorioListasPorAluno.estudante}">

					<f:facet name="header">
            			Listas Recuperadas
        			</f:facet>

					<p:column headerText="Nome da lista" sortBy="#{item.lista.nome}">
						<p:outputLabel value="#{item.lista.nome}" />
					</p:column>
					<p:column headerText="Descrição" sortBy="#{item.lista.descricao}">
						<p:outputLabel value="#{item.lista.descricao}" />
					</p:column>
					<p:column headerText="Data de criação"
						sortBy="#{item.lista.dataCriacao}">
						<p:outputLabel value="#{item.lista.dataCriacao}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
								timeZone="GMT-03:00" />
						</p:outputLabel>
					</p:column>
					<p:column headerText="Situação" sortBy="#{lista.situacao}">
						<p:outputLabel value="#{item.situacao.toString()}" />
					</p:column>
					
					<p:column headerText="Ações">
						<p:commandButton id="detalheListaButton"
							actionListener="#{relatorioListasPorAluno.definirListaDetalhes(item)}"
							oncomplete="PF('detalhesLista').show();"
							style="margin-right: 10px" icon="ui-icon-search"
							update=":#{p:component('detalhesLista')}"
							title="Ver detalhes da lista" />
							
						<p:commandButton icon="ui-icon-circle-close" id="botaoDeletar"
							actionListener="#{relatorioListasPorAluno.definirListaDetalhes(item)}"
							oncomplete="PF('confirmarExclusao').show();"
							update=":#{p:component('confirmarExclusao')}"
							rendered="#{item.podeSerExcluido}"
							title="Excluir lista" />

					</p:column>
				</p:dataTable>

			</p:fieldset>
		</h:form>
		
		<h:form id="formDetalhesLista" enctype="multipart">
			<p:dialog id="detalhesLista" header="Detalhes da Lista"
				widgetVar="detalhesLista" closable="true" height="400"
				width="800" closeOnEscape="true" showHeader="true" showEffect="true"
				position="center" responsive="true" draggable="true">
				<center>
					<p:panelGrid columns="2">
						<p:outputLabel value="Nome da lista" style="font-weight: bold" />
						<p:outputLabel value="#{relatorioListasPorAluno.listaSelecionada.lista.nome}" />

						<p:outputLabel value="Descricao" style="font-weight: bold" />
						<p:outputLabel
							value="#{relatorioListasPorAluno.listaSelecionada.lista.descricao}" />
							
						<p:outputLabel value="Data de criação da lista" style="font-weight: bold" />
						<p:outputLabel
							value="#{relatorioListasPorAluno.listaSelecionada.lista.dataCriacao}" >
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
								timeZone="GMT-03:00" />
						</p:outputLabel>

						<p:outputLabel value="Situação" style="font-weight: bold" />
						<p:outputLabel
							value="#{relatorioListasPorAluno.listaSelecionada.situacao.toString()}" />
						
						<p:outputLabel value="Data de vinculo" style="font-weight: bold" />
						<p:outputLabel
							value="#{relatorioListasPorAluno.listaSelecionada.dataAlteracao}" >
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm"
								timeZone="GMT-03:00" />
						</p:outputLabel>

					</p:panelGrid>
					<p:dataTable var="item" style="width: 400" id="tabelaAtividades"
						value="#{relatorioListasPorAluno.atividades}" rowIndexVar="rowIndex"
						emptyMessage="Não foram encontrados registros">
						<f:facet name="header">
            				Atividades
        				</f:facet>

						<p:column headerText="Nome da atividade">
							<p:outputLabel value="#{item.atividade.nome}" />
						</p:column>
						<p:column headerText="Template">
							<p:outputLabel value="#{item.atividade.templateToString}" />
						</p:column>
						<p:column headerText="Palavra">
							<p:outputLabel value="#{item.atividade.palavra}" />
						</p:column>
					</p:dataTable>
				</center>
			</p:dialog>
		</h:form>
		
		<p:dialog id="confirmarExclusao" header="Mensagem"
			widgetVar="confirmarExclusao" resizable="false" height="100"
			closeOnEscape="true" showHeader="true" responsive="true"
			draggable="true">
			<p:outputPanel style="text-align:center">
				<h:outputText value="Caro usuário, ao excluir a lista a mesma não estará disponível para o aluno realizar no aplicativo."
					style="font-weight: bold; color:gray" />
				<br/>
				<h:outputText style="font-weight: bold; color:gray" value="Porém, a lista ainda permanece disponível na funcionalidade de exercícios."/>
				<br/>
				<h:outputText style="font-weight: bold; color:gray" value="Tem certeza que deseja excluir a lista do aluno?"/>
				<br/>
				<br/>
			</p:outputPanel>
			<h:form>
				<center>
					<p:commandButton value="Sim"
						actionListener="#{relatorioListasPorAluno.excluir}"
						update=":#{p:component('fieldsetTabelaListas')} :confirmarExclusao :growl" />

					<p:commandButton value="Cancelar" update=":confirmarExclusao " />
				</center>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>